{"version":3,"sources":["web/front/src/semapps-map/semapps-map.js"],"names":["onMapClick","e","semapps","map","OSM","scrollWheelZoom","enabled","disable","enable","mouseOver","element","document","getElementById","$","animate","height","hide","style","display","show","mouseOut","getDetail","elem","goToPath","uri","window","encodeURIComponent","rel","hider","hiderBlock","addEventListener","querySelector","jqueryhider","hidertext","hasClass","removeClass","addClass","innerText","Polymer","is","properties","route","type","Object","observer","pins","Array","value","attached","this","ready","SemAppsCarto","start","bind","globalX","globalY","globalZoom","maxZoom","isAnonymous","L","minZoom","setView","tileLayer","attribution","addTo","markers","markerClusterGroup","addLayer","off","on","pinAvailaible","awesome","http://virtual-assembly.org/pair#Person","AwesomeMarkers","icon","markerColor","http://virtual-assembly.org/pair#Organization","http://virtual-assembly.org/pair#Project","http://virtual-assembly.org/pair#Event","http://virtual-assembly.org/pair#Proposal","http://virtual-assembly.org/pair#Document","http://virtual-assembly.org/pair#Good","pinShowAll","key","hasOwnProperty","pinShow","log","addPin","latitude","longitude","text","undefined","marker","bindPopup","pinShowOne","pinHideAll","getLatLng","pinHide","removeLayer","zoomGlobal","handleClick","preventDefault","scrollToContent","myRoute"],"mappings":"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","file":"semapps-map.min.js","sourcesContent":["Polymer({\n    is: 'semapps-map',\n\n    properties: {\n        route: {\n            type: Object,\n            observer: '_routeChanged'\n        },\n        pins: {\n            type: Array,\n            value: []\n        },\n    },\n\n    // Wait all HTML to be loaded.\n    attached() {\n        this.ready = false;\n        // Global ref.\n        semapps.map = this;\n\n        // Wait for buildings to be loaded.\n        SemAppsCarto.ready(this.start.bind(this));\n    },\n\n    start() {\n        \"use strict\";\n        this.globalX = 48.862725;\n        this.globalY = 2.287592000000018;\n        this.globalZoom = 6;\n        let maxZoom = (semapps.isAnonymous())? 12:18;\n        let minZoom = 0;\n\n        this.OSM = L.map('semapps',{maxZoom: maxZoom, minZoom:minZoom}).setView([this.globalX,this.globalY], this.globalZoom);\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n            attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n        }).addTo(this.OSM );\n        this.markers = L.markerClusterGroup();\n        this.OSM.addLayer(this.markers) ;\n        this.OSM.scrollWheelZoom.disable();\n        this.OSM.off('dblclick');\n        this.OSM.on('dblclick', onMapClick);\n        this.OSM.on('mouseover',mouseOver);\n        this.OSM.on('mouseout',mouseOut);\n        this.pinAvailaible = [];\n        this.awesome= {\n            \"http://virtual-assembly.org/pair#Person\":L.AwesomeMarkers.icon({\n                icon: 'user',\n                markerColor: 'blue'\n            }),\n            \"http://virtual-assembly.org/pair#Organization\":L.AwesomeMarkers.icon({\n                icon: 'tower',\n                markerColor: 'blue'\n            }),\n            \"http://virtual-assembly.org/pair#Project\":L.AwesomeMarkers.icon({\n                icon: 'screenshot',\n                markerColor: 'red'\n            }),\n            \"http://virtual-assembly.org/pair#Event\":L.AwesomeMarkers.icon({\n                icon: 'calendar',\n                markerColor: 'orange'\n            }),\n            \"http://virtual-assembly.org/pair#Proposal\":L.AwesomeMarkers.icon({\n                icon: 'info-sign',\n                markerColor: 'green'\n            }),\n            \"http://virtual-assembly.org/pair#Document\":L.AwesomeMarkers.icon({\n                icon: 'folder-open',\n                markerColor: 'black'\n            }),\n            \"http://virtual-assembly.org/pair#Good\":L.AwesomeMarkers.icon({\n                icon: 'shop',\n                markerColor: 'black'\n            }),\n        }\n        hider();\n\n    },\n\n    /**\n     * affiche tous les points enregistré\n     */\n    pinShowAll() {\n        \"use strict\";\n        for (let key in this.pins) {\n            if (this.pins.hasOwnProperty(key)) {\n                this.pinShow(key);\n            }\n        }\n    },\n\n    pinShow(key){\n        \"use strict\";\n        if (this.pins.hasOwnProperty(key) && this.pinAvailaible[key]) {\n            this.markers.addLayer(this.pins[key]);\n            this.pinAvailaible[key] = false;\n\n        }else{\n            log(\"error: \" + key + \" is not a marker\")\n            //log(this.pins)\n        }\n\n        //this.pins[key].addTo(this.OSM);\n    },\n\n\n    addPin(latitude,longitude, key, text,type) {\n        \"use strict\";\n        this.pinAvailaible[key] = true;\n        if (this.awesome[type] !== undefined) {\n            this.pins[key] = L.marker([latitude,longitude],  {icon: this.awesome[type]})\n                .bindPopup( '<a href=\"#\" onclick=\"getDetail(this)\" rel=\"'+key+'\"><h5>'+text+'</h5> </a>');\n        }else{\n            this.pins[key] = L.marker([latitude,longitude])\n                .bindPopup('<a href=\"#\" onclick=\"getDetail(this)\" rel=\"'+key+'\"><h5>'+text+' </h5></a>');\n        }\n\n        this.pinShow(key);\n    },\n    /**\n     * affiche un point et efface les autres\n     * @param key -- la clé qui va être la seule affiché\n     */\n    pinShowOne(key) {\n        \"use strict\";\n        this.pinHideAll();\n        this.pinShow(key);\n        this.OSM.setView(this.pins[key].getLatLng(),15,{animate: true});\n    },\n\n    /**\n     * efface un point\n     * @param key -- la clé du point a ne plus afficher\n     */\n    pinHide(key) {\n        \"use strict\";\n        if(this.pins[key] !== undefined && !this.pinAvailaible[key]){\n            let marker = this.pins[key];\n            this.markers.removeLayer(marker);\n            this.pinAvailaible[key] = true;\n        }\n\n    },\n\n    /**\n     * efface tous les points\n     */\n    pinHideAll() {\n        \"use strict\";\n        //log('start pinHideAll');\n        //log(this.pins);\n        for (let key in this.pins){\n            if (this.pins.hasOwnProperty(key)) {\n                this.pinHide(key);\n            }\n        }\n        //log('stop pinHideAll');\n\n    },\n\n    zoomGlobal(){\n        this.OSM.setView([this.globalX,this.globalY], this.globalZoom);\n    },\n\n    handleClick(e) {\n        e.preventDefault();\n        semapps.scrollToContent();\n        semapps.myRoute = \"detail\";\n        semapps.goToPath('detail', {\n            uri: window.encodeURIComponent(this.uri)\n        });\n    },\n\n\n});\n\nfunction onMapClick(e) {\n    //log('onMapClick');\n\n    if (semapps.map.OSM.scrollWheelZoom.enabled()) {\n        semapps.map.OSM.scrollWheelZoom.disable();\n    }\n    else {\n        semapps.map.OSM.scrollWheelZoom.enable();\n    }\n    mouseOver();\n}\nfunction mouseOver(e) {\n    //log('mouseOver');\n    let element = document.getElementById('semapps-map-black');\n    if(!semapps.map.OSM.scrollWheelZoom.enabled()){\n        $('#semapps-map-black').animate({ height: \"100%\"},'fast','linear');\n        element.style.display = 'block';\n        $('#semapps-map-message').show()\n    }\n    else{\n        $('#semapps-map-black').animate({ height: \"0px\"},'fast','linear');\n        $('#semapps-map-message').hide()\n    }\n}\nfunction mouseOut(e){\n    //log('mouseOut');\n\n    $('#semapps-map-message').hide();\n    $('#semapps-map-black').animate({ height: \"0px\"},'fast','linear')\n}\nfunction getDetail(elem) {\n    semapps.goToPath('detail', {\n        uri: window.encodeURIComponent(elem.rel)\n    });\n}\n\nfunction hider(){\n    var hiderBlock = document.getElementById(\"hider_block\")\n    hiderBlock.addEventListener(\"click\", function(e){\n        let map = document.querySelector(\".mapContent\");\n        let jqueryhider = $(hiderBlock);\n        let hidertext = document.getElementById(\"hider_text\");\n        let ishiding = jqueryhider.hasClass(\"shown\");\n\n        if (ishiding){\n            jqueryhider.removeClass(\"shown\");\n            jqueryhider.addClass(\"notshown\");            \n            hidertext.innerText = \"Afficher la carte\";\n            $(map).hide();\n        } else{\n            jqueryhider.addClass(\"shown\");\n            jqueryhider.removeClass(\"notshown\");            \n            hidertext.innerText = \"Cacher la carte\";            \n            $(map).show();\n        }\n    })\n}"]}