Polymer({is:'semapps-results',properties:{tabFirst:{type:Object,value:{type:'all',plural:'Tous',icon:'list'}},typeSelected:{type:String},tabs:{type:Array,value:[]},tabsRegistry:{type:Object,value:{}},results:{type:Array,value:[]},searchLastTerm:{type:String,value:null},route:{type:Object,observer:'_routeChanged'}},attached(){'use strict';semapps.results=this,this.domSearchResults=semapps.domId('searchResults'),this.domLoadingSpinner=semapps.domId('searchLoadingSpinner'),this.$searchThemeFilter=$('#searchThemeFilter'),SemAppsCarto.ready(()=>{let a=[],b='';$.each(semapps.entities,(c,d)=>{d.counter=0,b=''==b?c:b,a.push(d)}),this.tabs=a,this.selectType(b)})},tabRegister(a,b){'use strict';this.tabsRegistry[a]=b,this.selectType(this.typeSelected)},selectType(a){'use strict';this.selection(a),this.searchRender()},_routeChanged:function(a){'/rechercher'===a.prefix&&window.SemAppsCarto.ready(()=>{let b=a.path.split('/');log(b),this.search(b[1])})},callsearch(){let b=$(document.getElementById('isGV'));b.toggleClass('checked'),this.searchRender()},search(a){'use strict';let c=this.$searchThemeFilter.val();if(semapps.searchLastTerm===a&&semapps.searchLastFilter===c)return void this.searchRender();semapps.searchLastTerm=a=(a||'').replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,''),semapps.searchLastFilter=c,this.searchError=this.noResult=!1,this.results=[],this.domLoadingSpinner.style.display='block';let d=f=>{this.domLoadingSpinner.style.display='none',this.searchRender(f.responseJSON)};this.searchQueryLastComplete=d,semapps.ajax('webservice/search?term='+encodeURIComponent(a)+'&filter='+encodeURIComponent(semapps.searchLastFilter),f=>{'use strict';d===this.searchQueryLastComplete&&d(f)})},searchRender(a){'use strict';let b=[];this.searchError=this.noResult=!1,this.results.length=0,this.set('results',[]);let c=0,d={},f={};if(a=a||this.renderSearchResultResponse||{},this.renderSearchResultResponse=a,a.error)this.searchError=!0;else if(a.results){semapps.map.pinHideAll();for(let h of a.results)semapps.entities[h.type]&&(d[h.type]=d[h.type]||0,d[h.type]++,c++,'undefined'==typeof f[h.type]&&(f[h.type]=[]),f[h.type].push(h),h.address&&(void 0===semapps.map.pins[h.uri]?semapps.getAddressToCreatePoint(h.address,h.title,h.type,h.uri):semapps.map.pinShow(h.uri)));if('undefined'==typeof f[this.typeSelected]){let h=Object.keys(f)[0];this.selection(h),b='undefined'==typeof f[this.typeSelected]?[]:f[Object.keys(f)[0]]}else b=this.filterNonGrandVoisins(f[this.typeSelected]);let g='';g+=b.length?b.length+' r\xE9sultats ':'Aucun r\xE9sultat  ',this.resultsTitle=g,this.noResult=0===b.length}for(let g in this.tabsRegistry.all&&(this.tabsRegistry.all.counter=c),semapps.entities)this.tabsRegistry[g]&&(this.tabsRegistry[g].counter=d[g]||0);setTimeout(()=>{this.set('results',b)},100)},selection(a){this.typeSelected&&this.tabsRegistry[a]&&this.tabsRegistry[this.typeSelected].$$('li').classList.remove('active'),this.typeSelected=a,this.tabsRegistry[a]&&this.tabsRegistry[a].$$('li').classList.add('active')},filterNonGrandVoisins(a){let b=!0,c=document.getElementById('orgaGvFilter'),d=document.getElementById('isGV');if(b=!0==$(d).hasClass('checked'),'http://virtual-assembly.org/pair#Organization'!==this.typeSelected)c.style.display='none';else if(c.style.display='initial',!0==b){let f=[];a.forEach(g=>{('74 Avenue Denfert-Rochereau 75014 Paris'===g.address||'72 Avenue Denfert-Rochereau 75014 Paris'===g.address||'82 Avenue Denfert-Rochereau 75014 Paris'===g.address)&&f.push(g)}),a=f}return a}});
//# sourceMappingURL=semapps-results.min.js.map
