"use strict";Polymer({is:"semapps-results",properties:{tabFirst:{type:Object,value:{type:"all",plural:"Tous",icon:"list"}},typeSelected:{type:String},tabs:{type:Array,value:[]},tabsRegistry:{type:Object,value:{}},results:{type:Array,value:[]},otherArray:{type:Array,value:[]},searchLastTerm:{type:String,value:null},route:{type:Object,observer:"_routeChanged"}},attached:function(){var e=this;semapps.results=this,this.domSearchResults=semapps.domId("searchResults"),this.domLoadingSpinner=semapps.domId("searchLoadingSpinner"),this.$searchThemeFilter=$("#searchThemeFilter"),SemAppsCarto.ready(function(){var t=[],s="";$.each(semapps.entities,function(e,r){r.counter=0,s=""==s?e:s,t.push(r)}),e.tabs=t,e.selectType(s)})},tabRegister:function(e,t){this.tabsRegistry[e]=t,this.selectType(this.typeSelected)},selectType:function(e){this.selection(e),this.searchRender()},_routeChanged:function(e){var t=this;"/rechercher"===e.prefix&&window.SemAppsCarto.ready(function(){var s=e.path.split("/");t.search(s[2],s[1])})},callsearch:function(e){$(document.getElementById("isGV")).toggleClass("checked"),this.searchRender()},search:function(e,t){var s=this,r=this.$searchThemeFilter.val();if(semapps.searchLastTerm===e&&semapps.searchLastFilter===r)return void this.searchRender();semapps.searchLastTerm=e=(e||"").replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),semapps.searchLastFilter=r,this.searchError=this.noResult=!1,this.results=[],this.domLoadingSpinner.style.display="block";var i=function(e){s.domLoadingSpinner.style.display="none",s.searchRender(e.responseJSON)};this.searchQueryLastComplete=i,semapps.ajax("webservice/search?term="+encodeURIComponent(e)+"&type="+encodeURIComponent(this.typeSelected)+"&filter="+encodeURIComponent(semapps.searchLastFilter),function(e){i===s.searchQueryLastComplete&&i(e)})},searchRender:function(e){var t=this,s=[];this.searchError=this.noResult=!1,this.results.length=0,this.set("results",[]);var r=0,i={},a={},n={};if(e=e||this.renderSearchResultResponse||{},this.renderSearchResultResponse=e,e.error)this.searchError=!0;else if(e.results){semapps.map.pinHideAll();var l=!0,h=!1,p=void 0;try{for(var c,o=e.results[Symbol.iterator]();!(l=(c=o.next()).done);l=!0){var d=c.value;semapps.buildingSelected!==semapps.buildingSelectedAll&&d.building!==semapps.buildingSelected||(i[this.typeSelected]=i[this.typeSelected]||0,i[this.typeSelected]++,r++,semapps.buildings[d.building]&&(n[d.building]=n[d.building]||0,n[d.building]++),void 0===a[this.typeSelected]&&(a[this.typeSelected]=[]),a[this.typeSelected].push(d),d.address&&(void 0===semapps.map.pins[d.uri]?semapps.getAddressToCreatePoint(d.address,d.title,d.type,d.uri):semapps.map.pinShow(d.uri)))}}catch(e){h=!0,p=e}finally{try{!l&&o.return&&o.return()}finally{if(h)throw p}}this.otherArray=[],s=void 0!==a[this.typeSelected]?a[this.typeSelected]:[],s=s=this.filterNonGrandVoisins(s),"http://virtual-assembly.org/pair#Organization"===this.typeSelected?this.set("orga",!0):this.set("orga",!1);var u="";u+=s.length?s.length+" résultats ":"Aucun résultat  ",this.resultsTitle=u,this.noResult=0===s.length;var y=document.getElementById("searchResults");y.innerHTML="";var m=!0,g=!1,v=void 0;try{for(var f,S=s[Symbol.iterator]();!(m=(f=S.next()).done);m=!0){var b=f.value,R=document.createElement("semapps-results-"+semapps.entities[this.typeSelected].nameType.toLowerCase());R.data=b,R.parent=this,y.appendChild(R)}}catch(e){g=!0,v=e}finally{try{!m&&S.return&&S.return()}finally{if(g)throw v}}void 0!==semapps.schema&&(semapps.schema.pinHideAll(),$.each(semapps.buildings,function(e){(n[e]||e===semapps.buildingSelected)&&semapps.schema.pinShow(e,n[e]||0)}))}this.tabsRegistry.all&&(this.tabsRegistry.all.counter=r);for(var A in semapps.entities)this.tabsRegistry[A]&&(this.tabsRegistry[A].counter=i[A]);setTimeout(function(){0!==t.otherArray.length&&t.set("otherArray",t.otherArray),t.set("results",s)},100)},selection:function(e){this.typeSelected&&this.tabsRegistry[e]&&this.tabsRegistry[this.typeSelected].$$("li").classList.remove("active"),this.tabsRegistry[e]&&this.tabsRegistry[e].$$("li").classList.add("active"),e!==this.typeSelected&&(this.typeSelected=e,this.search())},filterNonGrandVoisins:function(e){var t=!0,s=document.getElementById("orgaGvFilter"),r=document.getElementById("isGV");if(t=1==$(r).hasClass("checked"),"http://virtual-assembly.org/pair#Organization"===this.typeSelected){s.style.display="initial";var i=[],a=[];e.forEach(function(e){"74 Avenue Denfert-Rochereau 75014 Paris"===e.address||"72 Avenue Denfert-Rochereau 75014 Paris"===e.address||"82 Avenue Denfert-Rochereau 75014 Paris"===e.address?(e.gv=!0,i.push(e)):(e.gv=!1,a.push(e))}),this.otherArray=1==t?[]:a,e=i}else s.style.display="none";return e}});
//# sourceMappingURL=semapps-results.min.js.map
