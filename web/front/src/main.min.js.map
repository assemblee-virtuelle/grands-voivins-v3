{"version":3,"sources":["web/front/src/main.js"],"names":["window","log","m","console","debug","readyCallbacks","SemAppsCarto","_class","mainComponent","_this","this","_classCallCheck","semapps","baseUrl","myRoute","location","pathname","replace","$window","$","detailAddress","buildingSelectedAll","buildingSelected","entities","http://virtual-assembly.org/pair#Organization","name","plural","icon","markerColor","http://virtual-assembly.org/pair#Person","http://virtual-assembly.org/pair#Project","http://virtual-assembly.org/pair#Event","http://virtual-assembly.org/pair#Proposal","http://virtual-assembly.org/pair#Document","http://virtual-assembly.org/pair#Good","http://virtual-assembly.org/pair#Service","http://virtual-assembly.org/pair#Place","urn://semapps/thesaurus/documenttype","urn://semapps/thesaurus/projecttype","urn://semapps/thesaurus/eventtype","urn://semapps/thesaurus/proposaltype","urn://semapps/thesaurus/organizationtype","http://assemblee-virtuelle.github.io/grands-voisins-v2/thesaurus.ttl","loadParameters","ajax","response","responseJSON","no_internet","start","_createClass","key","value","path","complete","url","sources","callback","ajaxCounter","allData","self","e","JSON","parse","responseText","call","parameters","extend","each","typeToName","hasOwnProperty","nameType","type","graphToName","domSearchTextInput","domId","isReady","split","get","isSearchPage","length","i","goSearch","term","building","document","results","search","goToPath","scrollTo","offset","top","duration","easing","id","event","Array","isArray","addEventListener","listen","getElementById","selector","querySelectorAll","params","set","indexOf","host","user","access","isSuperAdmin","isAdmin","isMember","string","lower","toLowerCase","a","toUpperCase","element","isAnonymous","haveName","preventDefault","currentTarget","getAttribute","address","title","uri","data","success","donnee","map","addPin","features","geometry","coordinates","ready","push"],"mappings":"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","file":"main.min.js","sourcesContent":["(function () {\n    'use strict';\n\n    // Devel\n    window.log = (m) => {\n        console.debug(m);\n    };\n\n    var readyCallbacks = [];\n\n\n    window.SemAppsCarto = class {\n\n        constructor(mainComponent) {\n            window.semapps = this;\n            this.baseUrl = '/';\n            this.myRoute = window.location.pathname.replace(/\\//g, '');\n            this.mainComponent = mainComponent;\n            this.$window = $(window);\n            this.detailAddress= [];\n            this.buildingSelectedAll = 'partout';\n            this.buildingSelected = this.buildingSelectedAll;\n            this.entities = {\n                \"http://virtual-assembly.org/pair#Organization\":{\n                    name: 'Organisation',\n                    plural: 'Organisations',\n                    icon: 'tower',\n                    markerColor: '#01acdd',\n                },\n                \"http://virtual-assembly.org/pair#Person\":{\n                    name: 'Personne',\n                    plural: 'Personnes',\n                    icon: 'user',\n                    markerColor: '#28ccfb',\n                },\n                \"http://virtual-assembly.org/pair#Project\":{\n                    name: 'Projet',\n                    plural: 'Projets',\n                    icon: 'screenshot',\n                    markerColor: '#FF4351',\n                }\n                ,\n                \"http://virtual-assembly.org/pair#Event\":{\n                    name: 'Evènement',\n                    plural: 'Evènements',\n                    icon: 'calendar',\n                    markerColor: '#FF667a',\n                }\n                ,\n                \"http://virtual-assembly.org/pair#Proposal\":{\n                    name: 'Proposition',\n                    plural: 'Propositions',\n                    icon: 'info-sign',\n                    markerColor: '#7b72e9',\n                }\n                ,\n                \"http://virtual-assembly.org/pair#Document\":{\n                    name: 'Document',\n                    plural: 'Documents',\n                    icon: 'folder-open',\n                    markerColor: '#a4de37',\n                }\n                ,\n                \"http://virtual-assembly.org/pair#Good\":{\n                    name: 'Good',\n                    plural: 'Goods',\n                    icon: 'gift',\n                    markerColor: '#a4de37',\n                }\n                ,\n                \"http://virtual-assembly.org/pair#Service\":{\n                    name: 'Service',\n                    plural: 'Services',\n                    icon: 'wrench',\n                    markerColor: '#a4de37',\n                }\n                ,\n                \"http://virtual-assembly.org/pair#Place\":{\n                    name: 'Place',\n                    plural: 'Places',\n                    icon: 'map-marker',\n                    markerColor: '#a4de37',\n                }\n                ,\n                \"urn://semapps/thesaurus/documenttype\":{\n                    name: 'Type de document',\n                    plural: 'Types de document',\n                    icon: 'pushpin',\n                    markerColor: '#a4de37',\n                }\n                ,\n                \"urn://semapps/thesaurus/projecttype\":{\n                    name: 'Type de projet',\n                    plural: 'Types de projets',\n                    icon: 'pushpin',\n                    markerColor: '#FF4351',\n                }\n                ,\n                \"urn://semapps/thesaurus/eventtype\":{\n                    name: 'Type d\\'événement',\n                    plural: 'Types d\\'événements',\n                    icon: 'pushpin',\n                    markerColor: '#FF667a' ,\n                }\n                ,\n                \"urn://semapps/thesaurus/proposaltype\":{\n                    name: 'Type de proposition',\n                    plural: 'Types de propositions',\n                    icon: 'pushpin',\n                    markerColor: '#7b72e9',\n                }\n                ,\n                \"urn://semapps/thesaurus/organizationtype\":{\n                    name: 'Type d\\'organisation',\n                    plural: 'Types d\\'organisations',\n                    icon: 'pushpin',\n                    markerColor: '#01acdd',\n                }\n                ,\n                \"http://assemblee-virtuelle.github.io/grands-voisins-v2/thesaurus.ttl\":{\n                    name: 'Type d\\'organisation',\n                    plural: 'Types d\\'organisations',\n                    icon: 'pushpin',\n                    markerColor: '#838e91',\n                }\n                ,\n            };\n\n            var loadParameters = () => {\n                this.ajax('webservice/parameters', (response) => {\n                    if (response && response.responseJSON && response.responseJSON.no_internet) {\n                        // Enter in debug mode.\n                        this.baseUrl = '/fake_service/';\n                        // Reload fake parameters.\n                        loadParameters();\n                    }\n                    else {\n                        this.start(response.responseJSON);\n                    }\n                });\n            };\n            // Load.\n            loadParameters();\n        }\n\n        ajax(path, complete) {\n            $.ajax({\n                url: this.baseUrl + path,\n                complete: complete\n            });\n        }\n\n        ajaxMultiple(sources, callback) {\n            \"use strict\";\n            var ajaxCounter = 0;\n            var allData = {};\n            var self = this;\n            for (var key in sources) {\n                ajaxCounter++;\n                this.ajax(sources[key], function (key) {\n                    return function (e) {\n                        ajaxCounter--;\n                        allData[key] = JSON.parse(e.responseText);\n                        // Final callback.\n                        if (ajaxCounter === 0) {\n                            callback.call(self, allData);\n                        }\n                    }\n                }(key));\n            }\n        }\n\n        start(parameters) {\n            \"use strict\";\n            $.extend(this, parameters);\n            $.each(this.entities, function(key, value) {\n                if(semapps.typeToName.hasOwnProperty(key)){\n                    semapps.entities[key].nameType = semapps.typeToName[key];\n                    semapps.entities[key].type = key;\n                }else{\n                    semapps.entities[key].nameType = semapps.graphToName[key];\n                    semapps.entities[key].type = 'http://www.w3.org/2004/02/skos/core#Concept';\n                }\n            });\n            // Shortcuts.\n            this.domSearchTextInput = this.domId('searchText');\n\n            // Launch callbacks\n            this.isReady = true;\n\n            let split = this.mainComponent.get('route.path').split('/');\n            let isSearchPage = split.length >= 2 && (split[1] === 'rechercher' || split[1] === '');\n            // We started on a search page.\n            if (isSearchPage && split[3]) {\n                this.domSearchTextInput.value = split[3];\n            }\n\n            // Ready callbacks.\n            for (let i in readyCallbacks) {\n                readyCallbacks[i]();\n            }\n\n            // We started on the arrival page or on the search page.\n            isSearchPage && this.goSearch();\n        }\n\n        goSearch() {\n            let term = this.domSearchTextInput.value;\n            let building = this.buildingSelected || 'partout';\n            let path = '/rechercher/'+ building + '/' + term;\n            // path += (term)? '/' + term : '';\n            if (document.location.pathname === path) {\n                // Reload search manually.\n                this.results.search(term, '');\n            }\n            else {\n                // Changing path will execute search action.\n                this.goToPath(path);\n            }\n        }\n\n        scrollToContent(complete) {\n            this.$window.scrollTo($('#pageContent').offset().top - 150, {\n                duration: 1000,\n                easing: 'easeOutQuad',\n                complete: complete\n            });\n        }\n\n        listen(id, event, callback) {\n            // Support list of events names.\n            if (Array.isArray(event)) {\n                for (let i in event) {\n                    this.listen(id, event[i], callback);\n                }\n                return;\n            }\n            return this.domId(id).addEventListener(event, callback);\n        }\n\n        domId(id) {\n            return document.getElementById(id);\n        }\n\n        dom(selector) {\n            return document.querySelectorAll(selector);\n        }\n\n        goToPath(path, params) {\n            this.myRoute = path;\n            // Set first params.\n            semapps.mainComponent.set('queryParams', params);\n            // Changing route fires an event.\n            semapps.mainComponent.set('route.path', path);\n        }\n\n        imageOrFallback(path, key) {\n            \"use strict\";\n            if (!path) {\n                if(semapps.entities.hasOwnProperty(key))\n                    return '/common/images/result-no_picture-' + semapps.entities[key].nameType + '.png';\n                else\n                    return null;\n            } else if (path.indexOf(\"http\") !== -1) {\n                return path;\n            }\n            return window.location.host + path;\n        }\n        haveName(){\n            return this.user.name !== '';\n        }\n        isSuperAdmin() {\n            return this.user.access === 'super_admin';\n        }\n\n        isAdmin() {\n            return (this.user.access === 'admin') || this.isSuperAdmin();\n        }\n\n        isMember() {\n            return (this.user.access === 'member') || this.isAdmin();\n        }\n\n        isAnonymous() {\n            return !this.isMember();\n        }\n\n        capitalize(string,lower) {\n            return (lower ? string.toLowerCase() : string).replace(/(?:^|\\s)\\S/g, function(a) { return a.toUpperCase(); });\n        };\n        /**\n         * Set parameters from global object,\n         * which are user into template as dynamic variables.\n         */\n        initElementGlobals(element) {\n            $.extend(element, {\n                isAnonymous: this.isAnonymous(),\n                isMember: this.isMember(),\n                isAdmin: this.isAdmin(),\n                isSuperAdmin: this.isSuperAdmin(),\n                haveName: this.haveName()\n            });\n        }\n\n        realLink(e) {\n            e.preventDefault();\n            // Force links to reload the hole page.\n            window.location.replace(e.currentTarget.getAttribute('href'));\n        }\n\n        getAddressToCreatePoint(address,title,type,uri){\n            $.ajax({\n                url : 'http://api-adresse.data.gouv.fr/search/', // on appelle le script JSON\n                data: 'q=' + address,\n                success : function(donnee){\n                    semapps.map.addPin(donnee.features[0].geometry.coordinates[1],donnee.features[0].geometry.coordinates[0], uri,title,type);\n                    semapps.detailAddress[address] = donnee;\n                },\n            });\n        }\n    };\n\n    window.SemAppsCarto.ready = function (callback) {\n        if (!window.semapps || !window.semapps.isReady) {\n            readyCallbacks.push(callback);\n        }\n        else {\n            callback();\n        }\n    };\n}());\n"]}